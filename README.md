# Crust DCAP &middot; [![GitHub license](https://img.shields.io/github/license/crustio/crust-dcap)](LICENSE)

Crust DCAP(Data Center Attestation Primitives) service is used to verify Crust sWorker entry-network identity quote using the DCAP QVL(Quote Verification Library), and returns the self-signed quote verification report to Crust sworker.

Crust DCAP service plays the similar role as the legacy IAS(Intel SGX Attestation Service) service, but using the ECDSA-based attestation instead of EPID-based attestation. For more information, please refer to [Intel SGX Remote Attestation](https://www.intel.com/content/www/us/en/developer/tools/software-guard-extensions/attestation-services.html).

## Prerequisites 
- Install git-lfs:
  ```
  curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | sudo bash
  sudo apt-get install git-lfs
  git lfs install
  ```

- Clone project
  ```
  git clone https://github.com/crustio/crust-dcap.git
  ```

## Install & Start
1. Run 'sudo <root_dir>/scripts/install_deps.sh' to install dependencies
1. Run 'sudo <root_dir>/scripts/install.sh' to install executable binary:dcap-service to /opt/crust/tools/bin
1. Run '/opt/crust/tools/bin/dcap-service' to start dcap-service, command options are as follows:
  - **-h, --help**: Show help information
  - **-t, --host**: Optional. Set server host, default is '0.0.0.0'
  - **-p, --port** Optional. Set server port, default is '1234'
  - **-s, --seed** Required. Set sr25519 scheme secret seed for signing. It can be generated by polkadot **subkey** program as 'subkey generate --scheme sr25519'

## Install & Start with docker
1. Run 'sudo <root_dir>/docker/build_env.sh' to build DCAP service environment docker
1. Run 'sudo <root_dir>/docker/build.sh' to build DCAP service docker, adding '-g' option will generate a docker-compose.yaml for you, which looks like:
   ```
   version: '2.0'
   services:
     dcap-service:
       image: 'crustio/dcap-service:1.0.0'
       network_mode: host
       container_name: dcap-service
       environment:
         DCAP_ARGS: '-p 17777 -s 1111111111111111111111111111111111111111111111111111111111111111'
         PCCS_PORT: '9999'
         PCS_API_KEY: '5e0d868dea9c450a886ce6c46913643e'
   ```
- **DCAP_ARGS** indicates DCAP service command options and arguments.
- **PCCS_PORT** indicates PCCS service port
- **PCS_API_KEY** indicates PCCS service api key

If you want to configure your own PCCS configuration, you can map your PCCS config file to docker container's PCCS config file located at '/etc/sgx_default_qcnl.conf'. Then, run 'sudo docker-compose up dcap-service' to start DCAP service.
